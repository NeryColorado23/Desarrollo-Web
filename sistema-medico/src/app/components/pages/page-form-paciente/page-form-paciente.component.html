<div class="registro-container">
  <mat-card class="registro-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>person_add</mat-icon>
        Sistema de Registro Médico
      </mat-card-title>
      <mat-card-subtitle>
        Complete los datos del paciente y su consulta médica
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">

        <!-- Sección: Búsqueda de Paciente -->
        <mat-card class="section-card">
          <mat-card-title>
            <mat-icon>search</mat-icon>
            Identificación del Paciente
          </mat-card-title>
          <mat-card-content>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Número de Cédula</mat-label>
              <input matInput formControlName="cedula" placeholder="Ingrese la cédula del paciente" maxlength="15">
              <mat-icon matSuffix>badge</mat-icon>
              <mat-error *ngIf="isFieldInvalid('cedula')">
                {{ getErrorMessage('cedula') }}
              </mat-error>
            </mat-form-field>

            <div class="button-group">
              <button mat-raised-button color="primary" type="button"
                      (click)="buscarPaciente()"
                      [disabled]="!registroForm.get('cedula')?.value">
                <mat-icon>search</mat-icon>
                Buscar Paciente
              </button>
              <button mat-stroked-button type="button" (click)="limpiarFormulario()">
                <mat-icon>clear</mat-icon>
                Limpiar Formulario
              </button>
            </div>

            <!-- Indicador de paciente encontrado -->
            <div *ngIf="pacienteEncontrado" class="patient-found-indicator">
              <mat-icon>check_circle</mat-icon>
              <div class="patient-info">
                <span class="patient-name">{{ getPacienteInfo() }}</span>
                <small>Solo complete los signos vitales y motivo de consulta</small>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Sección: Datos del Paciente -->
        <mat-card class="section-card">
          <mat-card-title>
            <mat-icon>person</mat-icon>
            Datos Personales del Paciente
          </mat-card-title>
          <mat-card-content>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Nombre</mat-label>
                <input matInput formControlName="nombre" placeholder="Nombre completo">
                <mat-icon matSuffix>person</mat-icon>
                <mat-error *ngIf="isFieldInvalid('nombre')">
                  {{ getErrorMessage('nombre') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Apellido</mat-label>
                <input matInput formControlName="apellido" placeholder="Apellidos completos">
                <mat-icon matSuffix>person_outline</mat-icon>
                <mat-error *ngIf="isFieldInvalid('apellido')">
                  {{ getErrorMessage('apellido') }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Teléfono</mat-label>
                <input matInput formControlName="telefono" placeholder="Número de contacto" type="tel">
                <mat-icon matSuffix>phone</mat-icon>
                <mat-error *ngIf="isFieldInvalid('telefono')">
                  {{ getErrorMessage('telefono') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email (opcional)</mat-label>
                <input matInput formControlName="email" placeholder="correo@ejemplo.com" type="email">
                <mat-icon matSuffix>email</mat-icon>
                <mat-error *ngIf="isFieldInvalid('email')">
                  {{ getErrorMessage('email') }}
                </mat-error>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Fecha de Nacimiento</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="fechaNacimiento" readonly>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-icon matSuffix>cake</mat-icon>
            </mat-form-field>
          </mat-card-content>
        </mat-card>

        <!-- Sección: Signos Vitales -->
        <mat-card class="section-card vital-signs">
          <mat-card-title>
            <mat-icon>monitor_heart</mat-icon>
            Signos Vitales
          </mat-card-title>
          <mat-card-subtitle>Registre los signos vitales actuales del paciente</mat-card-subtitle>
          <mat-card-content>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Presión Arterial</mat-label>
                <input matInput formControlName="presionArterial" placeholder="120/80 mmHg">
                <mat-icon matSuffix>favorite</mat-icon>
                <mat-hint>Formato: 120/80</mat-hint>
                <mat-error *ngIf="isFieldInvalid('presionArterial')">
                  {{ getErrorMessage('presionArterial') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Temperatura (°C)</mat-label>
                <input matInput type="number" formControlName="temperatura" placeholder="36.5" step="0.1" min="35" max="42">
                <mat-icon matSuffix>thermostat</mat-icon>
                <mat-hint>Rango: 35°C - 42°C</mat-hint>
                <mat-error *ngIf="isFieldInvalid('temperatura')">
                  {{ getErrorMessage('temperatura') }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Pulso (ppm)</mat-label>
                <input matInput type="number" formControlName="pulso" placeholder="72" min="40" max="200">
                <mat-icon matSuffix>monitor_heart</mat-icon>
                <mat-hint>Pulsaciones por minuto</mat-hint>
                <mat-error *ngIf="isFieldInvalid('pulso')">
                  {{ getErrorMessage('pulso') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Respiración (rpm)</mat-label>
                <input matInput type="number" formControlName="respiracion" placeholder="16" min="10" max="40">
                <mat-icon matSuffix>air</mat-icon>
                <mat-hint>Respiraciones por minuto</mat-hint>
                <mat-error *ngIf="isFieldInvalid('respiracion')">
                  {{ getErrorMessage('respiracion') }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Peso (kg)</mat-label>
                <input matInput type="number" formControlName="peso" placeholder="70.5" step="0.1" min="1">
                <mat-icon matSuffix>scale</mat-icon>
                <mat-hint>Peso en kilogramos</mat-hint>
                <mat-error *ngIf="isFieldInvalid('peso')">
                  {{ getErrorMessage('peso') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Talla (cm)</mat-label>
                <input matInput type="number" formControlName="talla" placeholder="170" min="50" max="250">
                <mat-icon matSuffix>straighten</mat-icon>
                <mat-hint>Altura en centímetros</mat-hint>
                <mat-error *ngIf="isFieldInvalid('talla')">
                  {{ getErrorMessage('talla') }}
                </mat-error>
              </mat-form-field>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Sección: Motivo de Consulta -->
        <mat-card class="section-card consultation">
          <mat-card-title>
            <mat-icon>edit_note</mat-icon>
            Información de la Consulta
          </mat-card-title>
          <mat-card-content>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Motivo de la Cita</mat-label>
              <textarea matInput formControlName="motivoCita" rows="4"
                       placeholder="Describa detalladamente el motivo de la consulta médica"
                       maxlength="500"></textarea>
              <mat-icon matSuffix>medical_services</mat-icon>
              <mat-hint align="end">{{ registroForm.get('motivoCita')?.value?.length || 0 }}/500</mat-hint>
              <mat-error *ngIf="isFieldInvalid('motivoCita')">
                {{ getErrorMessage('motivoCita') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Observaciones Adicionales (opcional)</mat-label>
              <textarea matInput formControlName="observaciones" rows="3"
                       placeholder="Observaciones, síntomas adicionales o notas importantes"
                       maxlength="300"></textarea>
              <mat-icon matSuffix>note</mat-icon>
              <mat-hint align="end">{{ registroForm.get('observaciones')?.value?.length || 0 }}/300</mat-hint>
            </mat-form-field>
          </mat-card-content>
        </mat-card>

        <!-- Botones de acción -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit"
                  [disabled]="registroForm.invalid"
                  class="submit-btn">
            <mat-icon>save</mat-icon>
            {{ pacienteEncontrado ? 'Agregar Nueva Consulta' : 'Registrar Nuevo Paciente' }}
          </button>

          <button mat-stroked-button type="button" (click)="volver()" class="back-btn">
            <mat-icon>arrow_back</mat-icon>
            Volver al Menú Principal
          </button>
        </div>

        <!-- Información del formulario -->
        <div class="form-info" *ngIf="registroForm.invalid && registroForm.touched">
          <mat-icon>info</mat-icon>
          <span>Complete todos los campos requeridos para continuar</span>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
